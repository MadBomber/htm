# public.nodes

## Description

Core memory storage for conversation messages and context

## Columns

| Name | Type | Default | Nullable | Children | Parents | Comment |
| ---- | ---- | ------- | -------- | -------- | ------- | ------- |
| id | bigint | nextval('nodes_id_seq'::regclass) | false | [public.tags](public.tags.md) |  |  |
| content | text |  | false |  |  | The conversation message/utterance content |
| speaker | text |  | false |  |  | Who said it: user or robot name |
| type | text |  | true |  |  | Memory type: fact, context, code, preference, decision, question |
| category | text |  | true |  |  | Optional category for organizing memories |
| importance | double precision | 1.0 | true |  |  | Importance score (0.0-1.0) for prioritizing recall |
| created_at | timestamp with time zone | CURRENT_TIMESTAMP | true |  |  | When this memory was created |
| updated_at | timestamp with time zone | CURRENT_TIMESTAMP | true |  |  | When this memory was last modified |
| last_accessed | timestamp with time zone | CURRENT_TIMESTAMP | true |  |  | When this memory was last accessed |
| token_count | integer |  | true |  |  | Number of tokens in the content (for context budget management) |
| in_working_memory | boolean | false | true |  |  | Whether this memory is currently in working memory |
| robot_id | text |  | false |  | [public.robots](public.robots.md) | ID of the robot that owns this memory |
| embedding | vector(2000) |  | true |  |  | Vector embedding (max 2000 dimensions) for semantic search |
| embedding_dimension | integer |  | true |  |  | Actual number of dimensions used in the embedding vector (max 2000) |

## Constraints

| Name | Type | Definition |
| ---- | ---- | ---------- |
| check_embedding_dimension | CHECK | CHECK (((embedding_dimension IS NULL) OR ((embedding_dimension > 0) AND (embedding_dimension <= 2000)))) |
| fk_rails_60162e9d3a | FOREIGN KEY | FOREIGN KEY (robot_id) REFERENCES robots(id) ON DELETE CASCADE |
| nodes_pkey | PRIMARY KEY | PRIMARY KEY (id) |

## Indexes

| Name | Definition |
| ---- | ---------- |
| nodes_pkey | CREATE UNIQUE INDEX nodes_pkey ON public.nodes USING btree (id) |
| idx_nodes_created_at | CREATE INDEX idx_nodes_created_at ON public.nodes USING btree (created_at) |
| idx_nodes_updated_at | CREATE INDEX idx_nodes_updated_at ON public.nodes USING btree (updated_at) |
| idx_nodes_last_accessed | CREATE INDEX idx_nodes_last_accessed ON public.nodes USING btree (last_accessed) |
| idx_nodes_type | CREATE INDEX idx_nodes_type ON public.nodes USING btree (type) |
| idx_nodes_category | CREATE INDEX idx_nodes_category ON public.nodes USING btree (category) |
| idx_nodes_robot_id | CREATE INDEX idx_nodes_robot_id ON public.nodes USING btree (robot_id) |
| idx_nodes_speaker | CREATE INDEX idx_nodes_speaker ON public.nodes USING btree (speaker) |
| idx_nodes_in_working_memory | CREATE INDEX idx_nodes_in_working_memory ON public.nodes USING btree (in_working_memory) |
| idx_nodes_embedding | CREATE INDEX idx_nodes_embedding ON public.nodes USING hnsw (embedding vector_cosine_ops) WITH (m='16', ef_construction='64') |
| idx_nodes_content_gin | CREATE INDEX idx_nodes_content_gin ON public.nodes USING gin (to_tsvector('english'::regconfig, content)) |
| idx_nodes_content_trgm | CREATE INDEX idx_nodes_content_trgm ON public.nodes USING gin (content gin_trgm_ops) |

## Relations

![er](public.nodes.svg)

---

> Generated by [tbls](https://github.com/k1LoW/tbls)
