<svg viewBox="0 0 900 750" xmlns="http://www.w3.org/2000/svg" style="background: transparent;">
  <!-- Title -->
  <text x="450" y="30" text-anchor="middle" fill="#FFFFFF" font-size="20" font-weight="bold">Eviction Process Sequence</text>

  <!-- Lifelines -->
  <!-- User -->
  <rect x="50" y="70" width="100" height="50" fill="rgba(76, 175, 80, 0.3)" stroke="#4CAF50" stroke-width="3" rx="5"/>
  <text x="100" y="100" text-anchor="middle" fill="#FFFFFF" font-size="13" font-weight="bold">User</text>
  <line x1="100" y1="120" x2="100" y2="700" stroke="#4CAF50" stroke-width="2" stroke-dasharray="5,5"/>

  <!-- HTM -->
  <rect x="200" y="70" width="100" height="50" fill="rgba(33, 150, 243, 0.3)" stroke="#2196F3" stroke-width="3" rx="5"/>
  <text x="250" y="100" text-anchor="middle" fill="#FFFFFF" font-size="13" font-weight="bold">HTM</text>
  <line x1="250" y1="120" x2="250" y2="700" stroke="#2196F3" stroke-width="2" stroke-dasharray="5,5"/>

  <!-- WorkingMemory -->
  <rect x="350" y="70" width="140" height="50" fill="rgba(33, 150, 243, 0.3)" stroke="#2196F3" stroke-width="3" rx="5"/>
  <text x="420" y="95" text-anchor="middle" fill="#FFFFFF" font-size="12" font-weight="bold">Working</text>
  <text x="420" y="110" text-anchor="middle" fill="#FFFFFF" font-size="12" font-weight="bold">Memory</text>
  <line x1="420" y1="120" x2="420" y2="700" stroke="#2196F3" stroke-width="2" stroke-dasharray="5,5"/>

  <!-- LongTermMemory -->
  <rect x="540" y="70" width="140" height="50" fill="rgba(156, 39, 176, 0.3)" stroke="#9C27B0" stroke-width="3" rx="5"/>
  <text x="610" y="95" text-anchor="middle" fill="#FFFFFF" font-size="12" font-weight="bold">LongTerm</text>
  <text x="610" y="110" text-anchor="middle" fill="#FFFFFF" font-size="12" font-weight="bold">Memory</text>
  <line x1="610" y1="120" x2="610" y2="700" stroke="#9C27B0" stroke-width="2" stroke-dasharray="5,5"/>

  <!-- Database -->
  <rect x="730" y="70" width="120" height="50" fill="rgba(156, 39, 176, 0.3)" stroke="#9C27B0" stroke-width="3" rx="5"/>
  <text x="790" y="95" text-anchor="middle" fill="#FFFFFF" font-size="12" font-weight="bold">Database</text>
  <line x1="790" y1="120" x2="790" y2="700" stroke="#9C27B0" stroke-width="2" stroke-dasharray="5,5"/>

  <!-- Sequence interactions -->
  <!-- 1. add_node -->
  <path d="M 100 160 L 250 160" stroke="#4CAF50" stroke-width="2" marker-end="url(#arr1)"/>
  <text x="175" y="155" text-anchor="middle" fill="#4CAF50" font-size="11">add_node(large_memory)</text>

  <!-- 2. add -->
  <path d="M 250 190 L 420 190" stroke="#2196F3" stroke-width="2" marker-end="url(#arr2)"/>
  <text x="335" y="185" text-anchor="middle" fill="#2196F3" font-size="11">add(key, value, token_count)</text>

  <!-- 3. Check -->
  <rect x="360" y="210" width="120" height="60" fill="rgba(255, 152, 0, 0.3)" stroke="#FF9800" stroke-width="2" rx="5"/>
  <text x="420" y="235" text-anchor="middle" fill="#FFFFFF" font-size="11">Check:</text>
  <text x="420" y="250" text-anchor="middle" fill="#FFFFFF" font-size="11">token_count +</text>
  <text x="420" y="265" text-anchor="middle" fill="#FFFFFF" font-size="11">current > max?</text>

  <!-- Decision boxes -->
  <rect x="520" y="300" width="180" height="60" fill="rgba(76, 175, 80, 0.3)" stroke="#4CAF50" stroke-width="3" rx="5"/>
  <text x="610" y="325" text-anchor="middle" fill="#FFFFFF" font-size="13" font-weight="bold">Space Available</text>
  <text x="610" y="345" text-anchor="middle" fill="#B0B0B0" font-size="10">(Add directly)</text>

  <rect x="210" y="300" width="180" height="60" fill="rgba(244, 67, 54, 0.3)" stroke="#F44336" stroke-width="3" rx="5"/>
  <text x="300" y="325" text-anchor="middle" fill="#FFFFFF" font-size="13" font-weight="bold">No Space</text>
  <text x="300" y="345" text-anchor="middle" fill="#B0B0B0" font-size="10">(Eviction needed)</text>

  <!-- Space available path -->
  <path d="M 480 240 L 610 240 L 610 300" stroke="#4CAF50" stroke-width="2" marker-end="url(#arr1)"/>
  <text x="545" y="235" text-anchor="middle" fill="#4CAF50" font-size="10">Space OK</text>

  <rect x="550" y="380" width="120" height="40" fill="rgba(76, 175, 80, 0.3)" stroke="#4CAF50" stroke-width="2" rx="5"/>
  <text x="610" y="405" text-anchor="middle" fill="#FFFFFF" font-size="11">Add node directly</text>

  <path d="M 610 360 L 610 380" stroke="#4CAF50" stroke-width="2" marker-end="url(#arr1)"/>
  <path d="M 610 420 L 610 440 L 250 440" stroke="#4CAF50" stroke-width="2" marker-end="url(#arr1)"/>
  <text x="430" y="435" text-anchor="middle" fill="#4CAF50" font-size="11">Success</text>

  <!-- No space path -->
  <path d="M 360 240 L 300 240 L 300 300" stroke="#F44336" stroke-width="2" marker-end="url(#arr5)"/>
  <text x="330" y="235" text-anchor="middle" fill="#F44336" font-size="10">No space</text>

  <!-- Eviction steps -->
  <rect x="250" y="380" width="150" height="40" fill="rgba(255, 152, 0, 0.3)" stroke="#FF9800" stroke-width="2" rx="5"/>
  <text x="325" y="405" text-anchor="middle" fill="#FFFFFF" font-size="11">Sort by [importance,</text>

  <rect x="250" y="435" width="150" height="40" fill="rgba(255, 152, 0, 0.3)" stroke="#FF9800" stroke-width="2" rx="5"/>
  <text x="325" y="460" text-anchor="middle" fill="#FFFFFF" font-size="11">-recency]</text>

  <path d="M 300 360 L 300 380" stroke="#FF9800" stroke-width="2" marker-end="url(#arr3)"/>
  <path d="M 325 420 L 325 435" stroke="#FF9800" stroke-width="2" marker-end="url(#arr3)"/>

  <rect x="250" y="490" width="150" height="40" fill="rgba(255, 152, 0, 0.3)" stroke="#FF9800" stroke-width="2" rx="5"/>
  <text x="325" y="515" text-anchor="middle" fill="#FFFFFF" font-size="11">Evict low-importance</text>

  <path d="M 325 475 L 325 490" stroke="#FF9800" stroke-width="2" marker-end="url(#arr3)"/>

  <!-- Note box -->
  <rect x="50" y="480" width="150" height="60" fill="rgba(255, 193, 7, 0.1)" stroke="#FFC107" stroke-width="2" rx="5" stroke-dasharray="5,5"/>
  <text x="125" y="500" text-anchor="middle" fill="#FFC107" font-size="10" font-weight="bold">Note:</text>
  <text x="125" y="515" text-anchor="middle" fill="#B0B0B0" font-size="9">Free enough tokens</text>
  <text x="125" y="530" text-anchor="middle" fill="#B0B0B0" font-size="9">for new memory</text>

  <!-- Return evicted nodes -->
  <path d="M 350 510 L 250 510" stroke="#F44336" stroke-width="2" marker-end="url(#arr5)"/>
  <text x="300" y="505" text-anchor="middle" fill="#F44336" font-size="10">evicted_nodes</text>

  <!-- mark_evicted -->
  <path d="M 250 560 L 610 560" stroke="#9C27B0" stroke-width="2" marker-end="url(#arr4)"/>
  <text x="430" y="555" text-anchor="middle" fill="#9C27B0" font-size="11">mark_evicted(keys)</text>

  <!-- UPDATE in_working_memory -->
  <path d="M 610 580 L 790 580" stroke="#9C27B0" stroke-width="2" marker-end="url(#arr4)"/>
  <text x="700" y="575" text-anchor="middle" fill="#9C27B0" font-size="11">UPDATE in_working_memory=FALSE</text>

  <!-- Database response -->
  <path d="M 790 600 L 610 600" stroke="#9C27B0" stroke-width="2" marker-end="url(#arr4)"/>
  <text x="700" y="595" text-anchor="middle" fill="#9C27B0" font-size="10">Updated</text>

  <!-- Add new node -->
  <rect x="360" y="620" width="120" height="40" fill="rgba(76, 175, 80, 0.3)" stroke="#4CAF50" stroke-width="2" rx="5"/>
  <text x="420" y="645" text-anchor="middle" fill="#FFFFFF" font-size="11">Add new node</text>

  <path d="M 325 530 L 325 640 L 360 640" stroke="#4CAF50" stroke-width="2" marker-end="url(#arr1)"/>
  <path d="M 480 640 L 530 640 L 530 600 L 610 600" stroke="#4CAF50" stroke-width="2"/>

  <path d="M 480 640 L 540 640 L 540 670 L 250 670" stroke="#4CAF50" stroke-width="2" marker-end="url(#arr1)"/>
  <text x="390" y="665" text-anchor="middle" fill="#4CAF50" font-size="11">Success</text>

  <!-- Return to user -->
  <path d="M 250 680 L 100 680" stroke="#4CAF50" stroke-width="2" marker-end="url(#arr1)"/>
  <text x="175" y="675" text-anchor="middle" fill="#4CAF50" font-size="11">node_id</text>

  <!-- Markers -->
  <defs>
    <marker id="arr1" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#4CAF50"/>
    </marker>
    <marker id="arr2" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#2196F3"/>
    </marker>
    <marker id="arr3" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#FF9800"/>
    </marker>
    <marker id="arr4" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#9C27B0"/>
    </marker>
    <marker id="arr5" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#F44336"/>
    </marker>
  </defs>
</svg>
